import 'dart:io';
import 'package:fluttertoast/fluttertoast.dart';
import 'package:excel/excel.dart';
import 'package:path_provider/path_provider.dart';

class FileOperations {
  static Future<String> getFilePath() async {
    final directory = await getExternalStorageDirectory();
    String currentDate = DateTime.now().toString().split(' ')[0].replaceAll('-', '_');
    return '${directory?.path}/IftarReport_$currentDate.xlsx';
  }

  static Future<void> exportToExcel(List<String> names, List<bool> checkboxValues, List<int> serialNumbers, int totalIndividuals, int checkedIndividuals, int totalSerials) async {
    var excel = Excel.createExcel();
    var sheet = excel['Sheet1'];

    sheet.appendRow(['Remaining Individuals', 'Completion %', 'Bag Count', 'Total Individuals']);
    sheet.appendRow([
      '${totalIndividuals - checkedIndividuals}',
      '${(checkedIndividuals / totalIndividuals * 100).toStringAsFixed(2)}%',
      '$totalSerials',
      '$totalIndividuals'
    ]);
    sheet.appendRow(['Bag Number', 'Name', 'Status']);
    for (int i = 0; i < names.length; i++) {
      sheet.appendRow([serialNumbers[i], names[i], checkboxValues[i] ? 'Distributed' : 'Not Distributed']);
    }

    File file = File(await getFilePath());
    await file.writeAsBytes(excel.encode()!);

    Fluttertoast.showToast(msg: 'Saved to ${file.path}', toastLength: Toast.LENGTH_LONG, gravity: ToastGravity.BOTTOM);
  }
}
